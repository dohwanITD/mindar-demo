<html>

<!-- 
[ CC Attrubute ]

Model Information:
* title:	Grass Lawn
* source:	https://sketchfab.com/3d-models/grass-lawn-7b7ef2ff56e041d1bcc2b330ea8b1f19
* author:	pooiloui2 (https://sketchfab.com/pooiloui2)
 
Model Information:
* title:	Low Poly Carrot
* source:	https://sketchfab.com/3d-models/low-poly-carrot-31df366e091a4e64b9b0cfc1afc0145d
* author:	thepianomonster (https://sketchfab.com/thepianomonster)

-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>  <!-- A-rame ver ^1.4.0 -->
  <!-- <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/16/Stats.min.js"></script>  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.1/howler.min.js"></script> <!-- Audio -->
  <!-- animation-mixer -->

  <!-- mind-ar -->
  <!-- <script src="./src/mindar-image-aframe-1280.prod.js" type="module"></script> -->

  <!--  -->
  <link rel="stylesheet" type="text/css" href="./src/subtitle.css">
  <script type='text/javascript' src='./src/step-ctrl.js'></script>

  <script>
    AFRAME.registerComponent('cloak', {
      init: function () {
        let geometry = new THREE.BoxGeometry(1, 1, 1)
        //  geometry.faces.splice(4, 2)
        let material = new THREE.MeshBasicMaterial({
          colorWrite: false
        })
        let mesh = new THREE.Mesh(geometry, material)
        mesh.scale.set(1.1, 1.1, 1.1)
        this.el.object3D.add(mesh)
      }
    })
  </script>

  <style>
    html,
    body {
      margin: 0;
    }

    .video {
      overflow: hidden;
      position: absolute;
      top:-3%;
      left: -3%;
      width: 108%;
      height: 108%;
    }
  </style>
</head>

<body>
  <video autoPlay=true playsInline=true muted=true ref=videoRef class="video"></video>

  <div class="example-container">

    <a-scene 
     loading-screen="enabled: false; dotsColor: #60584c; backgroundColor: #60584c"
     embedded color-space="sRGB" vr-mode-ui="enabled: false"
      renderer="colorManagement: true, physicallyCorrectLights" 
      device-orientation-permission-ui="enabled: false"
      gltf-model="basisTranscoderPath:https://cdn.jsdelivr.net/npm/super-three/examples/js/libs/basis/;" 
      step-ctrl
      >

      <a-assets>
        <a-asset-item id="rabbitModel" src="./assets/models/rabbit-resize-etc1s.glb"></a-asset-item>
        <a-asset-item id="carModel" src="./assets/models/car-resize-etc1s.glb"></a-asset-item>

        <a-asset-item id="carrotModel02" src="./assets/models/scene/carrot-resize-etc1s.glb"></a-asset-item>
        <a-asset-item id="lawnModel" src="./assets/models/scene/Grass-lawn-resize-etc1s.glb"></a-asset-item>
      </a-assets>

      <a-entity light="type: hemisphere;  intensity: 1; color: #ffffff; groundColor: #444444;" position="0, 20, 10"></a-entity>
      <a-entity light="type: directional; intensity: 1; color: #ffffff;" color="#ffffff" position="0, 20, 10"></a-entity>

      <a-camera position="0 0 0" look-controls="enabled: false">
        <a-entity position="0 -3 -12">

          <!-- Before Car, Masking -->
          <a-box position='7 2.5 0' scale="5 5 5" material='opacity: 0; color : grey;  side: back' cloak></a-box>
          <a-box position='-9.5 2.5 0' scale="5 5 5" material='opacity: 0; color : grey;  side: back' cloak></a-box>
          <a-box position='0 -3 0' scale="7 5 5" material='opacity: 0; color : grey;  side: back' cloak></a-box>

          <!-- Scenes -->
          <a-entity position="0 0 -1.5" shadow>
            
            <!-- Floor -->
            <a-entity position="0 0 -2">
              <a-gltf-model id="lawn" src="#lawnModel" scale="15 15 15" position="0 2.2 -2.5"></a-gltf-model>
              <a-gltf-model id="carrot02" src="#carrotModel02" scale="0.004 0.004 0.004" position="-2.5 0.7 3"
                rotation="30 90 -72"></a-gltf-model>
              <a-gltf-model id="carrot02" src="#carrotModel02" scale="0.004 0.004 0.004" position="-0.7 0.8 4"
                rotation="-25 90 -93"></a-gltf-model>
              <a-gltf-model id="carrot02" src="#carrotModel02" scale="0.004 0.004 0.004" position="1    0.8 2"
                rotation="0 90 -80"></a-gltf-model>
              <a-gltf-model id="carrot02" src="#carrotModel02" scale="0.004 0.004 0.004" position="3    0.7 3"
                rotation="0 90 -52"></a-gltf-model>
            </a-entity>

            <!-- car, Rabbit -->
            <a-entity position="0 0 -2.2">
              <a-gltf-model id="car" src="#carModel" position="8 0 0">
                <a-gltf-model id="rabbit" src="#rabbitModel" position="0 1 0" scale="0.85 0.85 0.85"
                  animation-mixer="clip: idle; loop: repeat; crossFadeDuration: 0.4; clampWhenFinished : true; startAt: 0"></a-gltf-model>
              </a-gltf-model>
            </a-entity>

          </a-entity>
        </a-entity>
      </a-camera>

    </a-scene>
  </div>

  <div id='subtitleBtn' class='subtitle'>
    <div id="sub">「갓생살기 with 펀드」</div>
  </div>

  <div id="click-hand" class="hand">
    <img src="./assets/images/click-hand-3d.gif" style="width:48px;height:48px;">
  </div>
</body>

<script>
  const video = document.querySelector('video');
    navigator.mediaDevices.getUserMedia({
      audio: false, video: { facingMode: "environment", width: { ideal: 1920 }, height: { ideal: 1080 } }
    }).then((stream) => {
      video.srcObject = stream
    });
</script>

</html>